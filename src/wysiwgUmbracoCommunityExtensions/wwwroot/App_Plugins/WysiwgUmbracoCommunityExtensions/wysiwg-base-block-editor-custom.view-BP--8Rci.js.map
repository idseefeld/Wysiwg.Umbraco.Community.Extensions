{"version":3,"file":"wysiwg-base-block-editor-custom.view-BP--8Rci.js","sources":["../../../Wysiwg/src/blocks/views/wysiwg-base-block-editor-custom.view.ts"],"sourcesContent":["import {\r\n  customElement,\r\n  LitElement,\r\n  property,\r\n  state,\r\n} from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\r\nimport type { UmbBlockEditorCustomViewConfiguration, UmbBlockEditorCustomViewElement } from \"@umbraco-cms/backoffice/block-custom-view\";\r\nimport {\r\n  UMB_PROPERTY_DATASET_CONTEXT,\r\n  UmbPropertyDatasetContext,\r\n  UmbPropertyValueDataPotentiallyWithEditorAlias,\r\n} from \"@umbraco-cms/backoffice/property\";\r\nimport { UmbBlockGridValueModel } from \"@umbraco-cms/backoffice/block-grid\";\r\nimport { UmbBlockDataModel, UmbBlockDataType } from \"@umbraco-cms/backoffice/block\";\r\n\r\nconst transparentBackgroundColor = \"#fff\";//work-a-round: color picker does not support transparent color\r\n\r\nconst customElementName = \"wysiwg-base.block-editor-custom-view\";\r\n@customElement(customElementName)\r\nexport class WysiwgBaseBlockEditorCustomViewElement\r\n  extends UmbElementMixin(LitElement)\r\n  implements UmbBlockEditorCustomViewElement {\r\n\r\n  @property({ attribute: false })\r\n  content?: UmbBlockDataType;\r\n\r\n  @property({ attribute: false })\r\n  config?: UmbBlockEditorCustomViewConfiguration;\r\n\r\n  @property({ attribute: false })\r\n  settings?: UmbBlockDataType;\r\n\r\n  @state()\r\n  datasetSettings?: UmbBlockDataModel[];\r\n\r\n  #datasetContext?: UmbPropertyDatasetContext;\r\n\r\n  constructor() {\r\n    super();\r\n    this.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, async (context) =>\r\n      this.getSettings(context)\r\n    );\r\n  }\r\n\r\n  isTransparentColor(color: string) {\r\n    return color === transparentBackgroundColor;\r\n  }\r\n\r\n  async getSettings(context: any) {\r\n    this.#datasetContext = context;\r\n    this.observe(\r\n      this.#datasetContext?.properties,\r\n      async (properties) => {\r\n        const pageProperties = properties as Array<UmbPropertyValueDataPotentiallyWithEditorAlias>;\r\n        if (pageProperties?.length) {\r\n          const allGridValues = pageProperties\r\n            .filter((v) => v.editorAlias === \"Umbraco.BlockGrid\") as Array<UmbPropertyValueDataPotentiallyWithEditorAlias>;\r\n\r\n          const editSettingsPath = this.config?.editSettingsPath ?? \"\";\r\n\r\n          let thisGrid = allGridValues[0];\r\n          if (allGridValues.length > 1) {\r\n            for (let i = 0; i < allGridValues.length; i++) {\r\n              const grid = allGridValues[i];\r\n              if (grid.alias && (editSettingsPath.indexOf(grid.alias) >= 0)) {\r\n                thisGrid = grid;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          const gridValues = thisGrid.value as UmbBlockGridValueModel;\r\n\r\n          this.prozessSettings(gridValues);\r\n\r\n          this.lastStepObservingProperties(pageProperties);\r\n        }\r\n      },\r\n      \"_observeProperties\"\r\n    );\r\n  }\r\n\r\n  async prozessSettings(gridValues: UmbBlockGridValueModel) {\r\n    this.datasetSettings = gridValues.settingsData;\r\n  }\r\n\r\n  async lastStepObservingProperties(pageProperties: Array<UmbPropertyValueDataPotentiallyWithEditorAlias>) {\r\n    if (!pageProperties) return;\r\n  }\r\n}\r\n\r\nexport default WysiwgBaseBlockEditorCustomViewElement;\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    [customElementName]: WysiwgBaseBlockEditorCustomViewElement;\r\n  }\r\n}\r\n"],"names":["_datasetContext","transparentBackgroundColor","customElementName","WysiwgBaseBlockEditorCustomViewElement","UmbElementMixin","LitElement","__privateAdd","UMB_PROPERTY_DATASET_CONTEXT","context","color","__privateSet","_a","__privateGet","properties","pageProperties","allGridValues","v","editSettingsPath","thisGrid","i","grid","gridValues","__decorateClass","property","state","customElement"],"mappings":";;;;;;;;;gUAAAA;AAgBA,MAAMC,IAA6B,QAE7BC,IAAoB;AAEnB,IAAMC,IAAN,cACGC,EAAgBC,CAAU,EACS;AAAA,EAgB3C,cAAc;AACN,UAAA,GAHRC,EAAA,MAAAN,CAAA,GAIO,KAAA;AAAA,MAAeO;AAAA,MAA8B,OAAOC,MACvD,KAAK,YAAYA,CAAO;AAAA,IAC1B;AAAA,EAAA;AAAA,EAGF,mBAAmBC,GAAe;AAChC,WAAOA,MAAUR;AAAA,EAAA;AAAA,EAGnB,MAAM,YAAYO,GAAc;;AAC9B,IAAAE,EAAA,MAAKV,GAAkBQ,CAAA,GAClB,KAAA;AAAA,OACHG,IAAAC,QAAKZ,CAAiB,MAAtB,gBAAAW,EAAsB;AAAA,MACtB,OAAOE,MAAe;;AACpB,cAAMC,IAAiBD;AACvB,YAAIC,KAAA,QAAAA,EAAgB,QAAQ;AAC1B,gBAAMC,IAAgBD,EACnB,OAAO,CAACE,MAAMA,EAAE,gBAAgB,mBAAmB,GAEhDC,MAAmBN,IAAA,KAAK,WAAL,gBAAAA,EAAa,qBAAoB;AAEtD,cAAAO,IAAWH,EAAc,CAAC;AAC1B,cAAAA,EAAc,SAAS;AACzB,qBAASI,IAAI,GAAGA,IAAIJ,EAAc,QAAQI,KAAK;AACvC,oBAAAC,IAAOL,EAAcI,CAAC;AAC5B,kBAAIC,EAAK,SAAUH,EAAiB,QAAQG,EAAK,KAAK,KAAK,GAAI;AAClD,gBAAAF,IAAAE;AACX;AAAA,cAAA;AAAA,YACF;AAGJ,gBAAMC,IAAaH,EAAS;AAE5B,eAAK,gBAAgBG,CAAU,GAE/B,KAAK,4BAA4BP,CAAc;AAAA,QAAA;AAAA,MAEnD;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAAA,EAGF,MAAM,gBAAgBO,GAAoC;AACxD,SAAK,kBAAkBA,EAAW;AAAA,EAAA;AAAA,EAGpC,MAAM,4BAA4BP,GAAuE;AAAA,EAClF;AAEzB;AArDEd,IAAA,oBAAA,QAAA;AAXAsB,EAAA;AAAA,EADCC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAJnBpB,EAKX,WAAA,WAAA,CAAA;AAGAmB,EAAA;AAAA,EADCC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAPnBpB,EAQX,WAAA,UAAA,CAAA;AAGAmB,EAAA;AAAA,EADCC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAVnBpB,EAWX,WAAA,YAAA,CAAA;AAGAmB,EAAA;AAAA,EADCE,EAAM;AAAA,GAbIrB,EAcX,WAAA,mBAAA,CAAA;AAdWA,IAANmB,EAAA;AAAA,EADNG,EAAcvB,CAAiB;AAAA,GACnBC,CAAA;"}