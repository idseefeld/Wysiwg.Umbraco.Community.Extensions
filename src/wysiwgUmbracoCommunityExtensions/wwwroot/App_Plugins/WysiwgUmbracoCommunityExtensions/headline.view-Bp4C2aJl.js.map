{"version":3,"file":"headline.view-Bp4C2aJl.js","sources":["../../../Wysiwg/src/blocks/views/headline.view.ts"],"sourcesContent":["import { UmbTextStyles } from \"@umbraco-cms/backoffice/style\";\r\nimport {\r\n  html,\r\n  customElement,\r\n  LitElement,\r\n  property,\r\n  css,\r\n  state,\r\n  unsafeHTML,\r\n} from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\r\nimport type {\r\n  UmbBlockDataModel,\r\n  UmbBlockDataType,\r\n} from \"@umbraco-cms/backoffice/block\";\r\nimport type { UmbBlockEditorCustomViewConfiguration, UmbBlockEditorCustomViewElement } from \"@umbraco-cms/backoffice/block-custom-view\";\r\nimport {\r\n  UMB_PROPERTY_DATASET_CONTEXT,\r\n  UmbPropertyDatasetContext,\r\n  UmbPropertyValueDataPotentiallyWithEditorAlias,\r\n} from \"@umbraco-cms/backoffice/property\";\r\nimport { UmbBlockGridValueModel } from \"@umbraco-cms/backoffice/block-grid\";\r\nimport { ColorType } from \"./types\";\r\n\r\nconst customElementName = \"wysiwg-block-headline-view\";\r\n@customElement(customElementName)\r\nexport class WysiwgBlockHeadlineView\r\n  extends UmbElementMixin(LitElement)\r\n  implements UmbBlockEditorCustomViewElement {\r\n  defaultColor: ColorType = { label: \"Black\", value: \"#000\" };\r\n\r\n  @property({ attribute: false })\r\n  content?: UmbBlockDataType;\r\n\r\n  @property({ attribute: false })\r\n  config?: UmbBlockEditorCustomViewConfiguration;\r\n\r\n  @property({ attribute: false })\r\n  settings?: UmbBlockDataType;\r\n\r\n  @state()\r\n  datasetSettings?: UmbBlockDataModel[];\r\n\r\n  #datasetContext?: UmbPropertyDatasetContext;\r\n\r\n  constructor() {\r\n    super();\r\n    this.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, async (context) =>\r\n      this.getSettings(context)\r\n    );\r\n  }\r\n\r\n  async getSettings(context: any) {\r\n    this.#datasetContext = context;\r\n    this.observe(\r\n      this.#datasetContext?.properties,\r\n      async (properties) => {\r\n        const pageProperties = properties as Array<UmbPropertyValueDataPotentiallyWithEditorAlias>;\r\n        if (pageProperties?.length) {\r\n          const allGridValues = pageProperties\r\n            .filter((v) => v.editorAlias === \"Umbraco.BlockGrid\") as Array<UmbPropertyValueDataPotentiallyWithEditorAlias>;\r\n\r\n          const editSettingsPath = this.config?.editSettingsPath ?? \"\";\r\n          console.debug(\"editSettingsPath: \", editSettingsPath);\r\n\r\n          let thisGrid = allGridValues[0];\r\n          if (allGridValues.length > 1) {\r\n            for (let i = 0; i < allGridValues.length; i++) {\r\n              const grid = allGridValues[i];\r\n              if (grid.alias && (editSettingsPath.indexOf(grid.alias) >= 0)) {\r\n                thisGrid = grid;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          const gridValues = thisGrid.value as UmbBlockGridValueModel;\r\n          console.debug(\"thisGrid.alias: \", thisGrid.alias);\r\n\r\n          if (gridValues.settingsData?.length) {\r\n            // headline specific\r\n            // const valueValue = pageProperties.find((v) => v.editorAlias === \"Umbraco.BlockGrid\")// && v.alias === \"main\")\r\n            //   ?.value as UmbBlockGridValueModel;\r\n            // this.datasetSettings = valueValue.settingsData;\r\n\r\n            this.datasetSettings = gridValues.settingsData;\r\n          }\r\n        }\r\n\r\n      },\r\n      \"_observeProperties\"\r\n    );\r\n  }\r\n\r\n  override render() {\r\n    let size = \"h1\";\r\n    let inlineStyle = \"\";\r\n    if (this.datasetSettings?.length) {\r\n      const layout = (this as UmbBlockEditorCustomViewElement).layout;\r\n      const settings = this.datasetSettings.filter(\r\n        (s) => layout?.settingsKey === s.key\r\n      )[0]?.values;\r\n\r\n      size =\r\n        settings\r\n          .filter((v) => v.alias === \"size\")[0]\r\n          ?.value?.toString()\r\n          .toLowerCase() ?? size;\r\n\r\n      const color =\r\n        (settings.filter((v) => v.alias === \"color\")[0]?.value as ColorType)\r\n          ?.value ?? this.defaultColor.value;\r\n      if (color) {\r\n        inlineStyle = `color: ${color};`;\r\n      }\r\n      const margin =\r\n        (settings.filter((v) => v.alias === \"margin\")[0]?.value as string) ??\r\n        \"\";\r\n      if (margin) {\r\n        inlineStyle += `margin: ${margin};`;\r\n      }\r\n\r\n      if (inlineStyle) {\r\n        inlineStyle = `style=\"${inlineStyle}\"`;\r\n      }\r\n    }\r\n    const headline = this.content?.text ?? \"Headline\";\r\n    const innerHtml = `<${size} ${inlineStyle}>${headline}</${size}>`;\r\n    return html`${unsafeHTML(innerHtml)}`;\r\n  }\r\n\r\n  static override styles = [\r\n    UmbTextStyles,\r\n    css`\r\n      :host {\r\n        display: block;\r\n        height: 100%;\r\n        box-sizing: border-box;\r\n        padding: 0;\r\n        margin: 0;\r\n        font-family: var(--wysiwg-font-family, initial);\r\n      }\r\n      h1, h2, h3 {\r\n        margin: 0;\r\n      }\r\n      h1 {\r\n        font-size: var(--wysiwg-headline-1-font-size, 32px);\r\n        line-height: var(--wysiwg-headline-1-line-height, 1.2em);\r\n        margin: var(--wysiwg-headline-1-margin, 0);\r\n      }\r\n      h2 {\r\n        font-size: var(--wysiwg-headline-2-font-size, 28px);\r\n        line-height: var(--wysiwg-headline-2-line-height, 1.2em);\r\n        margin: var(--wysiwg-headline-2-margin, 0);\r\n      }\r\n      h3 {\r\n        font-size: var(--wysiwg-headline-3-font-size , 24px);\r\n        line-height: var(--wysiwg-headline-3-line-height, 1.2em);\r\n        margin: var(--wysiwg-headline-3-margin, 0);\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\nexport default WysiwgBlockHeadlineView;\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    [customElementName]: WysiwgBlockHeadlineView;\r\n  }\r\n}\r\n"],"names":["_datasetContext","customElementName","WysiwgBlockHeadlineView","UmbElementMixin","LitElement","__privateAdd","UMB_PROPERTY_DATASET_CONTEXT","context","__privateSet","_a","__privateGet","properties","pageProperties","allGridValues","v","editSettingsPath","thisGrid","i","grid","gridValues","_b","size","inlineStyle","layout","settings","s","_d","_c","color","_f","_e","margin","_g","headline","_h","innerHtml","html","unsafeHTML","UmbTextStyles","css","__decorateClass","property","state","customElement","WysiwgBlockHeadlineView$1"],"mappings":"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"}